/*
 * Sear.js 0.1.0
 * (c) 2020 dragonwocky <thedragonring.bod@gmail.com>
 * (https://dragonwocky.me/) under the MIT License
 */

function Sear(t){class e extends Array{constructor(t,e){super(...t),this.__proto__.path=e}push(...t){super.push(...t),u(this.__proto__.path)}fill(...t){super.fill(...t),u(this.__proto__.path)}sort(...t){super.sort(...t),u(this.__proto__.path)}unshift(...t){super.unshift(...t),u(this.__proto__.path)}reverse(){super.reverse(),u(this.__proto__.path)}shift(){super.shift(),u(this.__proto__.path)}pop(){super.pop(),u(this.__proto__.path)}splice(...t){const e=Array.from(this);e.splice(...t),i[this.__proto__.path]=e}}const n={target:null,t:{},o(t,e){t.includes(this.target)||t.push(this.target),this.t[this.target].includes(e)||this.t[this.target].push(e)},s(t,e){return t.filter(t=>this.t[t].includes(e))},i(t){t.forEach(u)}};let r={};const o=t.l||document,s=t.u,i=function(t,e){return e&&"object"==typeof e?t&&"object"==typeof t?(t={...e,...t},Object.keys(t).forEach(n=>{Object.keys(e).includes(n)&&"function"!=typeof e[n]||delete t[n]}),t={...e,...t}):e:t}(JSON.parse(localStorage[s]||"{}"),t.data),c=t.watch,l={p:{},h:{},m:{}};!function t(e,n=[]){for(let r in e)if(e.hasOwnProperty(r)){let o=e[r];"function"==typeof o?d(e,r,o):Array.isArray(o)?f(e,r,n,!0):"object"==typeof o&&null!==o?t(o,n.concat(r)):f(e,r,n)}}(i),function t(e=o){function n(t,e){e=e.split(".");for(let n=0;n<e.length;n++)t=t[e[n]];return t}function r(t,e,n){for(e=e.split(".");e.length>1;)t=t[e.shift()];return t[e.shift()]=n,s&&(localStorage[s]=JSON.stringify(i)),t[e.shift()]}function c(t){let e;return t.attributes._id?e=t.attributes._id.value:(e=Math.random().toString(36).substr(2,9),t.setAttribute("_id",e)),e}const u={};e.querySelectorAll("[\\:pre]").forEach(t=>{let e=c(t);u[e]=t.outerHTML,t.outerHTML=`<span :pre _id="${e}"></span>`});const f={characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},d=new MutationObserver((function(t){t.forEach(t=>{if("characterData"!==t.type)return;let e=t.target;const o=e.attributes&&e.attributes[":html"]?":html":":text";for(;!e.attributes||!e.attributes[o];){if(!e.parentElement)return;e=e.parentElement}const s=e.attributes[o].value,c=t.target.innerHTML||t.target.data;n(i,s)!==c&&r(i,s,c)})}));(e.innerHTML?e:e.body).innerHTML=(e.innerHTML?e:e.body).innerHTML.replace(/{{([^{}]+)}}/g,'<span :text="$1"></span>'),e.querySelectorAll("[\\:text]").forEach(t=>{const e=t.attributes[":text"].value.trim();t.textContent=n(i,e),t.attributes[":unbound"]||(a(e,()=>t.textContent=n(i,e)),d.observe(t,f))}),e.querySelectorAll("[\\:html]").forEach(e=>{const r=e.attributes[":html"].value.trim();e.innerHTML=n(i,r),t(e),e.attributes[":unbound"]||(a(r,()=>e.innerHTML=n(i,r)),d.observe(e,f))}),e.querySelectorAll("[\\:value]").forEach(t=>{const e=t.attributes[":value"].value.trim();t.value=n(i,e),t.attributes[":unbound"]||(a(e,()=>t.value=n(i,e)),t.oninput=t=>r(i,e,t.target.value))}),e.querySelectorAll("[\\:if]").forEach(t=>{const r=t.attributes[":if"].value.trim();let o=c(t);const s=t.outerHTML;t.outerHTML=n(i,r)?s:`<span _id="${o}"></span>`,(t=e.querySelector(`[_id="${o}"]`)).attributes[":unbound"]||a(r,()=>{t.outerHTML=n(i,r)?s:`<span _id="${o}"></span>`,t=e.querySelector(`[_id="${o}"]`)})}),e.querySelectorAll("[\\:each]").forEach(e=>{const r=e.attributes[":each"].value.trim();let o=c(e);function s(e,r){const s=n(i,r);e.innerHTML="";for(let n=0;n<s.length;n++){const r=l.p[o].cloneNode(!0);r.innerHTML=r.innerHTML.replace(/\[\[:each:id]]/g,n+1).replace(/\[\[:each:value]]/g,s[n]),t(r),e.appendChild(r)}}l.p[o]||(l.p[o]=e.firstElementChild.cloneNode(!0)),s(e,r),e.attributes[":unbound"]||a(r,()=>s(e,r))});const p=["async","autofocus","autoplay","checked","contenteditable","controls","default","defer","disabled","formnovalidate","frameborder","hidden","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","readonly","required","reversed","scoped","selected","typemustmatch"];Array.from(e.getElementsByTagName("*")).filter(t=>{const e=Array.from(t.attributes);for(let t=0;t<e.length;t++)if(/^:bind:.+/.test(e[t].name))return!0;return!1}).forEach(t=>{let e=c(t);Array.from(t.attributes).filter(t=>/^:bind:.+/.test(t.name)).forEach(r=>{const o=r.name.slice(6),s=r.value.trim().split(" ").map(t=>t.split(","));function c(){let r=[];return s.forEach(t=>{n(i,t[0])&&r.push([t[1]||t[0]])}),r=r.join(""),r?p.includes(o)?["false",!1].includes(r)?t.removeAttribute(o):t.setAttribute(o,!0):t.setAttribute(o,r):l.m[e]&&![null,void 0].includes(l.m[e][o])?t.setAttribute(o,l.m[e][o]):void t.removeAttribute(o)}t.attributes[o]&&(l.m[e]||(l.m[e]={}),l.m[e][o]=t.attributes[o].value),c(),t.attributes[":unbound"]||s.forEach(t=>a(t[0],c))})}),e.querySelectorAll("[\\:pre]").forEach(t=>{let e=c(t);t.outerHTML=u[e]}),delete u}();for(let t in c)c.hasOwnProperty(t)&&a(t,c[t].bind(i));return i;function a(t,e){r[t]||(r[t]=[]),r[t].push(e)}function u(t){!r[t]||r[t].length<1||(r[t].forEach(t=>t()),s&&(localStorage[s]=JSON.stringify(i)))}function f(t,r,o,s){o=o.concat([r]).join(".");let i=[],c=s?new e(t[r],o):t[r];Object.defineProperty(t,r,{get:()=>(n.target&&n.o(i,r),c),set(t){c=s?new e(t,o):t,i=n.s(i,r),n.i(i,r),u(o)}})}function d(t,e,r){let o=null,s=[];a(e,()=>{o=null,s=n.s(s,e),n.i(s,e)}),Object.defineProperty(t,e,{get:()=>(n.target&&n.o(s,e),n.target=e,o||(n.t[e]=[],o=r.call(t)),n.target=null,o),set(){}})}}
