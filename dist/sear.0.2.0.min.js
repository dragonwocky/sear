/*
  * Sear.js 0.2.0
  * (c) 2020 dragonwocky <thedragonring.bod@gmail.com>
  * (https://dragonwocky.me/) under the MIT License
  */

function Sear(t){class e extends Array{constructor(t,e){super(...t),this.__proto__.path=e}copyWithin(...t){super.copyWithin(...t),d(this.__proto__.path,{t:clone,o:this})}fill(...t){super.fill(...t),d(this.__proto__.path,{t:clone,o:this})}pop(...t){super.pop(...t),d(this.__proto__.path,{t:clone,o:this})}push(...t){super.push(...t),d(this.__proto__.path,{t:clone,o:this})}reverse(...t){super.reverse(...t),d(this.__proto__.path,{t:clone,o:this})}sort(...t){super.sort(...t),d(this.__proto__.path,{t:clone,o:this})}shift(...t){super.shift(...t),d(this.__proto__.path,{t:clone,o:this})}unshift(...t){const e=Array.from(this);super.unshift(...t),d(this.__proto__.path,{t:e,o:this})}splice(...t){const e=Array.from(this);e.splice(...t),y(c,this.__proto__.path,e)}}const n=["async","autofocus","autoplay","checked","contenteditable","controls","default","defer","disabled","formnovalidate","frameborder","hidden","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","readonly","required","reversed","scoped","selected","typemustmatch"];let o={};const s=t.s||document,i=t.i,c=function(t,e){return e&&"object"==typeof e?t&&"object"==typeof t?(t={...e,...t},Object.keys(t).forEach(n=>{Object.keys(e).includes(n)&&"function"!=typeof e[n]||delete t[n]}),t={...e,...t}):e:t}(function(t){try{if((t=JSON.parse(localStorage[t]||"{}"))&&"object"==typeof t)return t}catch(t){return"{}"}}(i),t.data),r=t.watch,l=[],u={target:null,l:{},u(t,e){t.includes(this.target)||t.push(this.target),this.l[this.target].includes(e)||this.l[this.target].push(e)},h(t,e){return t.filter(t=>this.l[t].includes(e))},p(t){t.forEach(d)}};!function t(e,n=[]){for(let o in e)if(e.hasOwnProperty(o)){const s=e[o];"function"==typeof s?h(e,o,s):Array.isArray(s)?f(e,o,n,!0):"object"==typeof s&&null!==s?t(s,n.concat(o)):f(e,o,n)}}(c),function t(e=s){e===document&&(e=e.body);const o={};e.querySelectorAll("[\\:pre]").forEach(t=>{const e=b(t);o[e]=t.outerHTML,t.outerHTML=`<span :pre _id="${e}"></span>`}),e.innerHTML=e.innerHTML.replace(/{{([^{}]+)}}/g,'<span :text="$1"></span>'),e.querySelectorAll("[\\:text]").forEach(t=>{const e=t.attributes[":text"].value.trim();t.textContent=p(c,e),t.attributes[":unbound"]||a(e,()=>t.textContent=p(c,e))}),e.querySelectorAll("[\\:html]").forEach(e=>{const n=e.attributes[":html"].value.trim();e.innerHTML=p(c,n),t(e),e.attributes[":unbound"]||a(n,()=>e.innerHTML=p(c,n))}),e.querySelectorAll("[\\:value]").forEach(t=>{const e=t.attributes[":value"].value.trim();let n=p(c,e);t.attributes.type&&["radio","checkbox"].includes(t.attributes.type.value.trim())?(t.checked=n||!1,t.attributes[":unbound"]||(a(e,()=>{n=p(c,e),t.checked=n||!1}),t.onchange=t=>y(c,e,t.target.checked))):(t.value=n,t.attributes[":unbound"]||(a(e,()=>t.value=p(c,e)),t.oninput=t=>y(c,e,t.target.value)))}),e.querySelectorAll("[\\:if]").forEach(t=>{const n=t.attributes[":if"].value.trim(),o=b(t),s=t.outerHTML,i=t.attributes[":unbound"];function r(){t.outerHTML=p(c,n)?s:`<span _id="${o}"></span>`,t=e.querySelector(`[_id="${o}"]`)}r(),i||a(n,r)}),e.querySelectorAll("[\\:else]").forEach(t=>{const n=t.attributes[":else"].value.trim(),o=b(t),s=t.outerHTML,i=t.attributes[":unbound"];function r(){t.outerHTML=p(c,n)?`<span _id="${o}"></span>`:s,t=e.querySelector(`[_id="${o}"]`)}r(),i||a(n,r)}),e.querySelectorAll("[\\:each]").forEach(e=>{const n=e.attributes[":each"].value.trim(),o=e.firstElementChild.cloneNode(!0);function s(){const s=p(c,n);if(s){e.innerHTML="";for(let n=0;n<s.length;n++){const i=o.cloneNode(!0);i.innerHTML=i.innerHTML.replace(/\[\[:each:id]]/g,n+1).replace(/\[\[:each:value:html]]/g,s[n]),t(i),i.innerHTML=i.innerHTML.replace(/\[\[:each:value]]/g,"<span :each:value></span>"),i.querySelectorAll("[\\:each\\:value]").forEach(t=>t.textContent=s[n]),e.appendChild(i)}}}s(),e.attributes[":unbound"]||a(n,s)}),Array.from(e.getElementsByTagName("*")).filter(t=>{const e=Array.from(t.attributes);for(let t=0;t<e.length;t++)if(/^:bind:.+/.test(e[t].name))return!0;return!1}).forEach(t=>{const e={};Array.from(t.attributes).filter(t=>/^:bind:.+/.test(t.name)).forEach(o=>{const s=o.name.slice(6),i=o.value.trim().split(" ").map(t=>t.split(","));function r(){let o=i.map(t=>{const e=p(c,t[0]);return t[1]?e?t[1]:void 0:e}).filter(t=>![null,void 0].includes(t)).join(" ");return o?n.includes(s)?["false",!1].includes(o)?t.removeAttribute(s):t.setAttribute(s,!0):t.setAttribute(s,o):[null,void 0].includes(e[s])?void t.removeAttribute(s):t.setAttribute(s,e[s])}t.attributes[s]&&(e[s]=t.attributes[s].value),r(),t.attributes[":unbound"]||i.forEach(t=>a(t[0],r))})}),e.querySelectorAll("[\\:pre]").forEach(t=>t.outerHTML=o[b(t)])}();for(let t in r)r.hasOwnProperty(t)&&a(t,r[t].bind(c));return c;function a(t,e){o[t]||(o[t]=[]),o[t].push(e)}function d(t,e){!o[t]||o[t].length<1||(o[t].forEach(t=>t(e)),i&&(localStorage[i]=JSON.stringify(c)))}function f(t,n,o,s){o=o.concat([n]).join(".");let i=[],c=s?new e(t[n],o):t[n];Object.defineProperty(t,n,{get:()=>(u.target&&u.u(i,n),c),set(t){const r=c;c=s?new e(t,o):t,i=u.h(i,n),u.p(i,n),d(o,{t:r,o:c})}})}function h(t,e,n){let o=null,s=[];a(e,()=>{o=null,s=u.h(s,e),u.p(s,e)}),Object.defineProperty(t,e,{get:()=>(u.target&&u.u(s,e),u.target=e,o||(u.l[e]=[],o=n.call(t)),u.target=null,o),set(){}})}function p(t,e){for(e=e.split(".");e.length>1;)if(!(t=t[e.shift()]))return;return t[e]}function y(t,e,n){for(e=e.split(".");e.length>1;)if(!(t=t[e.shift()]))return;return t[e.shift()]=n,i&&(localStorage[i]=JSON.stringify(c)),n}function b(t){let e;if(t.attributes._id)e=t.attributes._id.value;else{do{e=Math.random().toString(36).substr(2,9)}while(l.includes(e));t.setAttribute("_id",e),l.push(e)}return e}}
