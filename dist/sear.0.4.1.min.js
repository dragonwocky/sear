/*
  * Sear.js 0.4.1
  * (c) 2020 dragonwocky <thedragonring.bod@gmail.com>
  * (https://dragonwocky.me/) under the MIT License
  */

"use strict";class Sear{constructor(t){this.t=t.s||!1,"object"==typeof t.format&&(this.i={version:t.format.version,o:t.format.o||function(){return{}}}),this.h=this.u(t.data,this.p(t.s)),this.l=this.clone(this.h,["function",void 0]),this.j=class extends Array{constructor(t,e,r){super(...t),this.__proto__.path=e,this.__proto__.parent=r}m(t,...e){const r=Array.from(this),s=r[t](...e);return this.__proto__.parent.set(this.__proto__.parent.O,this.__proto__.path,r),s}copyWithin(...t){return this.m("copyWithin",...t)}fill(...t){return this.m("fill",...t)}pop(...t){return this.m("pop",...t)}push(...t){return this.m("push",...t)}reverse(...t){return this.m("reverse",...t)}sort(...t){return this.m("sort",...t)}shift(...t){return this.m("shift",...t)}unshift(...t){return this.m("unshift",...t)}splice(...t){return this.m("splice",...t)}},this.v={A:[null],g:{}},this.O=new Proxy(this.h,this.k());const e=(t,r=[])=>{Object.keys(t).forEach(s=>{if("object"==typeof t[s]&&!Array.isArray(t[s]))return e(t[s],[...r,s]);"function"==typeof t[s]&&this.get(this.O,[...r,s])})};e(this.h),this.$={},this.S=t.watch||{};for(let t in this.S)if(this.S.hasOwnProperty(t)){if("function"!=typeof this.S[t])throw new Error(`[Sear] Watchers must be functions! Offender: <${t}>`);this.observe(t,this.S[t].bind(this.O)),this.get(this.O,t)}return this._=[],this.D=["async","autofocus","autoplay","checked","contenteditable","controls","default","defer","disabled","formnovalidate","frameborder","hidden","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","readonly","required","reversed","scoped","selected","typemustmatch"],document.addEventListener("DOMContentLoaded",()=>{this.F=t.M||document.body,this.N()}),this.O}u(...t){if(!t.length)return{};const e={},r=(t,s=[])=>{Object.keys(t).forEach(n=>{if("object"==typeof t[n]&&!Array.isArray(t[n]))return r(t[n],[...s,n]);this.set(e,[...s,n],t[n])})};return t.forEach(t=>r(t)),e}clone(t,e){let r;if(e&&typeof t===e[0])return e[1];if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return r=new Date,r.setTime(t.getTime()),r;if(Array.isArray(t)){r=[];for(let s=0;s<t.length;s++)r[s]=this.clone(t[s],e);return r}if(t.constructor===Object){r={};for(let s in t)t.hasOwnProperty(s)&&(r[s]=this.clone(t[s],e));return r}throw new Error(`[Sear] <${t.constructor.name}> is an unsupported data type!\n\nSupported data types are: (Basic) Objects, Functions, Arrays, Dates, Strings, Numbers, and Booleans.\n`)}isEqual(t,e){const r=Object.prototype.toString.call(t);if(r!==Object.prototype.toString.call(e))return!1;if(["[object Array]","[object Object]"].indexOf(r)<0)return t==e;const s="[object Array]"===r?t.length:Object.keys(t).length;if(s!==("[object Array]"===r?e.length:Object.keys(e).length))return!1;function n(t,e){const r=Object.prototype.toString.call(t);if(["[object Array]","[object Object]"].indexOf(r)>=0){if(!this.isEqual(t,e))return!1}else{if(r!==Object.prototype.toString.call(e))return!1;if("[object Function]"===r){if(t.toString()!==e.toString())return!1}else if(t!==e)return!1}return!0}if("[object Array]"===r){for(let r=0;r<s;r++)if(!1===n(t[r],e[r]))return!1}else for(let r in t)if(t.hasOwnProperty(r)&&!1===n(t[r],e[r]))return!1;return!0}s(t,e){if(!t)return!1;const r=this.clone(e),s={},n=(t,e=[])=>{Object.keys(t).filter(e=>"object"==typeof t[e]).forEach(r=>{this.set(s,[...e,r],{}),n(t[r],[...e,r])}),Object.keys(t).filter(e=>"function"==typeof t[e]).forEach(r=>{this.set(s,[...e,r],t[r].toString().trim()),delete t[r]})};n(r);const i={data:r,W:s};return"_format"in this&&(i.version=this.i.version),localStorage[t]=JSON.stringify(i)}p(store){if(!store)return{};try{if(store=JSON.parse(localStorage[store]||"{}"),store&&"object"==typeof store){store.data=store.data||{},store.W=store.W||{};const process=(obj,path=[])=>{Object.keys(obj).forEach(key=>{if("object"==typeof obj[key])return process(obj[key],[...path,key]);try{return eval(`this.set(store.computed, [...path, key], (${obj[key].startsWith("function")?"":"function"} ${obj[key]})`)}catch(t){return this.set(store.W,[...path,key],new Function(`return (${obj[key].startsWith("function")?"":"function"} ${obj[key]})`)())}})};process(store.W);const parsed=this.u(store.data,store.W);return"_format"in this&&store.version!==this.i.version?this.i.o(parsed):parsed}}catch(t){return{}}}observe(t,e){this.$[t]||(this.$[t]=[]),this.$[t].push(e)}q(t){this.s(this.t,this.h);const e=(t=Array.isArray(t)?t:t.split(".")).join("."),r=this.get(this.h,e);for(;t.length;){let e=t.join(".");this.$[e]&&this.$[e].forEach(t=>{const r=this.clone(this.get(this.l,e));"function"==typeof r&&this.set(this.l,e,void 0),t(r)}),t.pop()}return"function"!=typeof r&&this.set(this.l,e,this.clone(r)),!0}k(t=[]){const e=this;return{get(r,s){if(!(s in r))return;const n=[...t,s].join("."),i=e.v.A[e.v.A.length-1];if("function"==typeof r[s]){i&&!e.v.g[i].includes(n)&&e.v.g[i].push(n),e.v.A.push(n),e.get(e.l,n)||(e.v.g[n]=[],e.set(e.l,n,e.clone(r[s].call(e.O))));const t=e.get(e.l,n);return e.v.A.pop(),t}return i&&!e.v.g[i].includes(n)&&e.v.g[i].push(n),Array.isArray(r[s])?new e.j(r[s],[...t,s],e):"object"==typeof r[s]&&null!==r[s]?new Proxy(r[s],e.k([...t,s])):r[s]},set(r,s,n){if(e.isEqual(r[s],n))return!0;const i=[...t,s].join(".");return r[s]=n,Object.keys(e.v.g).forEach(t=>{e.v.g[t].includes(i)&&e.q(t)}),e.q([...t,s]),!0}}}B(t=[]){const e=this;return{get:(t,e)=>t[e],set:(r,s,n)=>!!e.isEqual(r[s],n)||(r[s]=n,e.q([...t]),!0)}}get(t,e){for(e=Array.isArray(e)?e:e.split(".");e.length>1;)if(!(t=t[e.shift()]))return;return t[e]}set(t,e,r){for(e=Array.isArray(e)?e:e.split(".");e.length>1;){const r=e.shift();t[r]||(t[r]={}),t=t[r]}return t[e.shift()]=r,r}J(t){let e;if(t.attributes._id)e=t.attributes._id.value;else{do{e=Math.random().toString(36).substr(2,9)}while(this._.includes(e));t.setAttribute("_id",e),this._.push(e)}return e}N(t=this.F){t===document&&(t=t.body);const e=this,r={};t.querySelectorAll("[\\:pre]").forEach(t=>{const s=e.J(t);r[s]=t.outerHTML,t.outerHTML=`<span :pre _id="${s}"></span>`}),t.innerHTML=t.innerHTML.replace(/{{([^{}]+)}}/g,'<span :text="$1"></span>'),t.querySelectorAll("[\\:text]").forEach(t=>{const r=t.attributes[":text"].value.trim();t.textContent=e.get(e.O,r),t.attributes[":unbound"]||e.observe(r,()=>t.textContent=e.get(e.O,r))}),t.querySelectorAll("[\\:html]").forEach(t=>{const r=t.attributes[":html"].value.trim();t.innerHTML=e.get(e.O,r),e.N(t),t.attributes[":unbound"]||e.observe(r,()=>t.innerHTML=e.get(e.O,r))}),t.querySelectorAll("[\\:value]").forEach(t=>{const r=t.attributes[":value"].value.trim();let s=e.get(e.O,r);t.attributes.type&&["radio","checkbox"].includes(t.attributes.type.value.trim())?(t.checked=s||!1,t.attributes[":unbound"]||(e.observe(r,()=>{s=e.get(e.O,r),t.checked=s||!1}),t.onchange=t=>e.set(e.O,r,t.target.checked))):(t.value=s,t.attributes[":unbound"]||(e.observe(r,()=>t.value=e.get(e.O,r)),t.oninput=t=>e.set(e.O,r,t.target.value)))}),t.querySelectorAll("[\\:if]").forEach(r=>{const s=r.attributes[":if"].value.trim(),n=e.J(r),i=r.outerHTML,o=r.attributes[":unbound"];function c(){r.outerHTML=e.get(e.O,s)?i:`<span _id="${n}"></span>`,r=t.querySelector(`[_id="${n}"]`)}c(),o||e.observe(s,c)}),t.querySelectorAll("[\\:else]").forEach(r=>{const s=r.attributes[":else"].value.trim(),n=e.J(r),i=r.outerHTML,o=r.attributes[":unbound"];function c(){r.outerHTML=e.get(e.O,s)?`<span _id="${n}"></span>`:i,r=t.querySelector(`[_id="${n}"]`)}c(),o||e.observe(s,c)}),t.querySelectorAll("[\\:each]").forEach(t=>{const r=t.attributes[":each"].value.trim(),s=t.firstElementChild.cloneNode(!0);function n(){const n=e.get(e.O,r);if(n){t.innerHTML="";for(let r=0;r<n.length;r++){const i=s.cloneNode(!0);i.innerHTML=i.innerHTML.replace(/\[\[:each:id]]/g,r+1).replace(/\[\[:each:value:html]]/g,n[r]),e.N(i),i.innerHTML=i.innerHTML.replace(/\[\[:each:value]]/g,"<span :each:value></span>"),i.querySelectorAll("[\\:each\\:value]").forEach(t=>t.textContent=n[r]),t.appendChild(i)}}}n(),t.attributes[":unbound"]||e.observe(r,n)}),Array.from(t.getElementsByTagName("*")).filter(t=>{const e=Array.from(t.attributes);for(let t=0;t<e.length;t++)if(/^:bind:.+/.test(e[t].name))return!0;return!1}).forEach(t=>{const r={};Array.from(t.attributes).filter(t=>/^:bind:.+/.test(t.name)).forEach(s=>{const n=s.name.slice(6),i=s.value.trim().split(" ").map(t=>t.split(","));function o(){let s=i.map(t=>{const r=e.get(e.O,t[0]);return t[1]?r?t[1]:void 0:r}).filter(t=>![null,void 0].includes(t)).join(" ");return s?e.D.includes(n)?["false",!1].includes(s)?t.removeAttribute(n):t.setAttribute(n,!0):t.setAttribute(n,s):[null,void 0].includes(r[n])?void t.removeAttribute(n):t.setAttribute(n,r[n])}t.attributes[n]&&(r[n]=t.attributes[n].value),o(),t.attributes[":unbound"]||i.forEach(t=>e.observe(t[0],o))})}),t.querySelectorAll("[\\:pre]").forEach(t=>t.outerHTML=r[e.J(t)])}}
